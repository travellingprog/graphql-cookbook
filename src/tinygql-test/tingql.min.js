!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.TinyGQL=r()}(this,function(){function e(e){e=e||{},this.opts={url:e.url||"/graphql",usePromise:e.usePromise||!1,sendModifier:e.sendModifier||null},this.fragments={}}function r(e){var r={};return"string"==typeof e[0]?(r.query=e[0],e[1]&&"[object Function]"===Object.prototype.toString.call(e[1])?r.callback=e[1]:(r.variables=e[1],r.callback=e[2])):r=e[0],{query:r.query,variables:r.variables||null,operationName:r.operationName||null,fragments:r.fragments||null,sendModifier:r.sendModifier||null,errorHandler:r.errorHandler||null,callback:r.callback}}function n(e,r,o){if(-1===e.indexOf("..."))return o;for(var t in r)-1!==e.indexOf("..."+t)&&(o.push(r[t]),o=n(r[t],r,o));return o}function o(e,r,n,o){o.length&&(e=[e].concat(fragment).join("\n"));var t={query:e};return r&&(t.variables=r),n&&(t.operationName=n),t}function t(e,r){var n=new XMLHttpRequest;return n.responseType="json",n.open("POST",e),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json"),n.onload=function(){if("string"==typeof n.response&&(n.response=JSON.parse(n.response)),n.response.errors){var e=Error("the GraphQL response has errors "+JSON.stringify(n.response.errors));e.name="TinyGQLQueryError",e.raw=n.response.errors,r(e,null)}else r(null,n.response.data)},n.onerror=function(e){e.name="TinyGQLRequestError",r(e,null)},n}return e.prototype.storeFragment=function(){return"fragmentName"},e.prototype.removeFragment=function(e){delete this.fragments[e]},e.prototype.send=function(){var e=null,s=r(Array.prototype.slice.call(arguments)),i=s.query,a=s.variables,l=s.operationName,u=s.fragments||[],f=s.sendModifier||this.sendModifier,p=s.callback;u=n(i,this.fragments,u),this.usePromise&&(e=new Promise(function(e,r){p=function(n,o){n?r(n):e(o)}}));var c=o(i,a,l,u),d=t(this.opts.url,p);if(f){var m=f({xhr:d,body:c});c=m.body,d=m.xhr}return d.send(JSON.stringify(c)),e},e});